<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
     <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="LeagueGothic/fontface.css" />
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <title></title>
    <style>
        .cpxx {
                width: 190px;
    min-height: 40px;
    height:auto;
    margin-top: 3%;
    /* margin: 0 auto; */
    float: left;
   margin-left:192px;
           
        }
        .w2 {
               height: 93px;
    padding-top: 32px;
    width: 524px;
    margin-left: 198px;
        }
        h2 {
          margin-top:10px;
        }
         .cpxxjs {
            width:100%;
           
            
            float:left;
            
        }
           .cpxxjs span {
            width:auto;
            margin:5px;
            
           text-align:center;
         
            float:left;
             
        }
             .cpxxjs span:hover {
           color:red;
             
        }
        .cpxxtp {
            width:100%;
               margin-top: 132px;
            
            float:left;
        }
                .cpxxtp textarea {
                       width: 457px;
    height: auto;
    min-height: 100px;
    margin-top: 10px;
    min-height: 294px;
}
         .cpbztp {
             position:relative;
            width:400px;
               
               margin-left: 366px;
            float:left;
        }
        .cpbztp img {     width: 289px;
    height: 300px;
    margin: 10px;
    float: left;   }
        .cpbztp input {       position: absolute;
    width: 289px;
    height: 300px;
    margin: 10px;
    opacity: 0;}
             .cpxxjs textarea {
                    width: 457px;
    height: auto;
    min-height: 100px;
}
               
            
            .cpxx label {
                float:left;
                width:30%;

            }
              .cpxx input {
                float:left;
                min-width:50px;
                   
                width:auto;
                height: 37px;
               

            }
        #img1 {
            width:60%;
            margin-left:20%;
            margin-top:20px;
            height:auto;
        }
          .claitem{ height:auto;width:94%;float:left;margin:20px} 
                .clatitle{height: 30px;margin-bottom:5px;
    font-size: 24px;
    width: 100%;
    float: left;
    color: #ea9595;
    font-weight: 900;
    text-align: center;}
                .cla{height:auto;width:auto;float:left;color:black;    padding: 4px;font-size:18px}
                    .cla:hover { color:white;background-color:red;border-radius:5px}
textarea::-webkit-input-placeholder {
       color: #ddd;
       text-align: center;
       font-size:40px;
   }
textarea {
    font-size:30px;
       vertical-align: baseline;
       caret-color:#EB3142;
   }
/*定义滚动条高宽及背景 高宽分别对应横竖滚动条的尺寸*/  
::-webkit-scrollbar  
{  
    width: 4px;  
    height: 4px;  
    background-color: #F5F5F5;  
}  
 /*定义滚动条轨道 内阴影+圆角*/  
::-webkit-scrollbar-track  
{  
    -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);  
    border-radius: 10px;  
    background-color: #FFF;  
}
/*定义滑块 内阴影+圆角*/  
::-webkit-scrollbar-thumb  
{  
    border-radius: 10px;  
    -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);  
    background-color: #5eeaee;  
}
                      .login-form-mask {
z-index: 9998;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: #000;
opacity: 0.4;
filter: alpha(opacity=40);
display: none
}
.login-form {
    overflow:scroll;
    
z-index: 9999;
position: fixed;
top: 40%;
left: 45%;
    min-width: 400px;
    max-width:800px;
    width: auto;
height: auto;
    max-height: 400px;
margin: -180px 0 0 -330px;
border-radius: 5px;
border: solid 2px #666;
background-color: #fff;
display: none;
box-shadow: 0 0 10px #666;
}
.login-close {
margin-right: 15px;
}
 .alertheader{ width:100%;height:400px;position:relative}
    .alertlabel{ width:100%;height:30px;text-align:center}
    .alertcancle{width:45%;float:left;height:30px;margin-right:2%;    position: absolute;  top: 0;color:black;}
    .alertconfirm{width:45%;float:left;height:30px;margin-left:2%;display:none;    text-align: center;}
        .allselect {
        background:url(xgb17-h.png);
        background-size:cover;
            height: 39px;
    width: 17px;
        float:left;

        }



          .basicval{
            height:390px;
            width:100%;
            position:relative;
            background-color:white;
            float:left;
            }
        .basicvaltit {
           position: relative;
    height: 49px;
    width: 100%;
    background-color: white;
    float: left;
    background: #7f0101;
    font-size: 30px;
        }
        .basicvaltit input {
           border: 0px;
    height: 50px;
    text-align: center;
    font-size: 30px;
    background: #7f0505;
    color: white;
    top: 0;
      position:absolute;
        }

        .imgupload {
           height: 145px;
    width: 133px;position:absolute;left:15px;top:10px;
       /*background-image:url(tp.jpg);*/
       /*background-size:cover;*/
             }
            .imgupload img {
               height: 145px;
    width: 133px;
            }
        .imgupload input{
   width: 138px;
    height: 136px;
    opacity:0;
    filter:alpha(opacity=0);
    position:absolute;
    left:0;
    top:0;
     
        }
        #mainsc, #fl {
      
            width: 100%;
    height: 93px;
    
        }
        .addin {
            height: 263px;
    width: 200px;
    /* margin-left: 15%; */
    margin-left: -196px;
    float: left;
    margin-top: 205px;
        }

        .maincontent {
               margin: 0 auto;
    width: 923px;
    height: 590px;
}
        .bleft {
            left:0px;
        } .bright {
              left:90%;
        }

        .intitle {
       width:100%;height:22px;font-size:20px;background-color:#f7750f;float:left;text-align:center;
        }

          .buzhouslt{ background: #fff7f7;
    width: 100%;
    height: 130px;
    position: absolute;
    margin-top: 79px;}
        .bzsltitem{   
            position:relative;  
    width: 100px;
    height: 130px;
    float: left;
    text-align: center;
    color: black;
     }
        .bzsltitem img{width:100px;height:100px;float:left}
        .bzsltitem p{width:100px;height:30px;float:left;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;}
        .bzconfirm {
              height: 100px;
    width: 100px;
    font-size: 30px;
    position: absolute;
    margin-left: -101px;
    margin-top: 101px;
    border: 0px;
    background-color: #d41111;
    color: white;
        }

        .results {
         margin-left:400px;
        }
        .addbztpaa {
           height: 100px;
    width: 100px;
    /* font-size: 30px; */
    position: absolute;
    left: 0;
    border: 0px;
    opacity: 0;
    /* background-color: #d41111; */
    color: white;
        }


            .login-form-mask2 {
z-index: 9998;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: #000;
opacity: 0.4;
filter: alpha(opacity=40);
display: none
}
.login-form2 {
z-index: 9999;
position: fixed;
top: 40%;
left: 55%;
width: 400px;
height: 100px;
margin: -180px 0 0 -330px;
border-radius: 5px;
border: solid 2px #666;
background-color: #fff;
display: none;
box-shadow: 0 0 10px #666;
}
.login-close2 {
margin-right: 15px;
}

   
    .alertcancle2{width:45%;float:left;height:30px;margin-right:2%;    position: absolute;  top: 0;}
    .alertconfirm2{width:45%;float:left;height:30px;margin-left:2%;     color: black;    text-align: center;}






      #delcpb {
               margin-left: 29px;
    margin-top: 13px;
    height: 42px;
    position: absolute;
    width: 100px;
    color: #ece6e6;
    padding-top: 7px;
    font-size: 22px;
    text-align: center;
    background: #f7750f;
    border-radius: 5px;
        }
       #delcpb:hover {
             
    color: white;
   
    background: #ff5509;
    
        } 

     .backto {
               margin-left: 159px;
    margin-top: 13px;
    height: 42px;
    position: absolute;
    width: 100px;
    color: #ece6e6;
    padding-top: 7px;
    font-size: 22px;
    text-align: center;
    background: #f7750f;
    border-radius: 5px;
        }
      .backto:hover {
             
    color: white;
   
    background: #ff5509;
    
        }


       .stepdel {
           position:absolute;
           top:30px;
           left:50px;
             height: 42px;
             padding-top: 7px;
            font-size: 22px;
               text-align: center;
                  background: #f7750f;
                    color: #ece6e6;
                     border-radius: 5px;
        }
       
           
      .stepdel:hover {
             
    color: white;
   
    background: #ff5509;
    
        }

         .insertst {
              height: 20px;
    right: 10px;
    position: absolute;
    margin-top: 42px;
        }
    </style>
    <script></script>
</head>
<body>

      <div class="login-form" id="searchresult">
 
 <div class="alertheader" id="basic">
 
</div>
<div class="alertcancle" onclick="alertcancle()"> 取消</div> 
<!--<div class="alertconfirm" onclick="alertconfirm()"> 确定</div>-->
      
      <div class="alertconfirm" id="prestep" onclick="prestep()"> 上一步</div>
      <div class="alertconfirm" id="nextstep" onclick="nextstep()"> 下一步</div>
</div>
<div class="login-form-mask"></div>

<div class="step" id="step1">
    <div class="section">
        <h1 >Step 1  <p id="subtitle">输入菜谱信息</p></h1>
           
       <p class="backto" onclick="backto()">返回</p>
        <div class="maincontent">
        <div style="min-height:500px;height:auto;width:365px;margin-left:5%;float:left;    margin-top: 10px;">
          
         <p class="basicvaltit"><input  id="menuname" placeholder="菜品名称"/> </p>
        <div id="basicval"  class="basicval"> <!--UploadImg Handler2-->
            <form id="cptp" action="/ashx/Index.ashx" method="post" enctype="multipart/form-data"> 
                 <div class="imgupload" >                        
                      <img src="tp.jpg" id="menuimg" /> 
                     <input type="text" id="tpty" name="tpty" value="cp" style="display:none" />
                      <!--<input type="text" id="cptppath" name="cptppath"  value="" style="display:none" />-->
                      <input type="text" id="menunumber" name="menunumber"  value="" style="display:none" />
                      <input type="text" id="usernumber" name="usernumber"  value="" style="display:none" />
                   
                      <input type="text" id="bzcount" name="bzcount" value="1" style="display:none" />
                     <input type="file" id="file1" name="file1" accept="image/*" />

                 </div>
                </form>
             <div class="cpxx">   <input id="kw" placeholder="口味" /><span class="allselect" onclick="getaa(0)"></span> </div>
             <div class="cpxx">    <input id="gy" placeholder="工艺" /><span class="allselect" onclick="getaa(1)"></span></div> 
             <div class="cpxx">  <input id="menutype" placeholder="菜品类型" /><span class="allselect" onclick="getaa(3)"></span></div>
           <div class=""><p class="intitle">主食材</p>  <textarea id="mainsc" placeholder=""  disabled="disabled"></textarea></div>
           <div class=""> <p class="intitle">辅料</p> <textarea id="fl" placeholder=" " disabled="disabled"></textarea></div>
         </div>
     
         
       </div>
        <div class="addin"> 
             <div class="cpxx w2">  <input id="addmainsc" placeholder="主食材" /><span class="allselect" onclick="getaa(2)"></span>
                   <input id="mainscingredientval" value="0" /> <select id='mainscunit' style="width:120px;height:28px;" >
         <option value="适量">适量</option>
　　　　<option value="克">克</option> 
　　　　<option value="勺">勺</option>
　　　　<option value="汤匙">汤匙</option>
　　　　<option value="茶匙">茶匙</option>
　　　　<option value="个">个</option>
　　　　<option value="只">只</option>                                                                                                                                                           
　　</select>   
                 <span onclick="addingredient('main')">添加</span>
             </div>
             <div class="cpxx w2">  <input id="addfl" placeholder="辅料" /><span class="allselect" onclick="getaa(4)"></span>
                   <input id="flingredientval" value="0" /> <select id='flunit' style="width:120px;height:28px;" >
         <option value="适量">适量</option>
　　　　<option value="克">克</option> 
　　　　<option value="勺">勺</option>
　　　　<option value="汤匙">汤匙</option>
　　　　<option value="茶匙">茶匙</option>
　　　　<option value="个">个</option>
　　　　<option value="只">只</option>                                                                                                                                                           
　　</select>   
                 <span onclick="addingredient('fl')">添加</span>
             </div>
            
           
        <!--  <div class="cpxx">  <input id="cptp" placeholder="成品图片"  /></div>-->
         </div>
        <div style="height:200px;width:40%;margin-left:5%;float:left;    margin-top: 10px;">
          <div class="cpxxjs">
         <span onclick="changgeIT('I')">菜品基本介绍</span><span onclick="changgeIT('T')">烹饪小技巧</span>
        <textarea id="introduce" placeholder="菜品基本介绍"></textarea>
         <textarea id="Tips" placeholder="烹饪小技巧" style="display:none"></textarea>
          </div>
       </div>
  
            </div>
         <a   onclick="test()">Test</a>
      <a class="button back bleft" onclick="back()">Back</a>
		<a href="#" id="step1next" class="button bright" onclick="inputcheck('all')">Next</a>
    </div>
</div>

<div class="step" id="step2">
    <div class="section">
        <h1>Step 2 <p>菜谱步骤</p></h1>
       <span onclick="deletestep()" class="stepdel">删除步骤</span>
      <div class="insertst"><input id="insertstepid" value="0" /> <span onclick="insertstep()" >插入步骤</span></div>
       <form id="hh" action="/ashx/Handler2.ashx" method="post" enctype="multipart/form-data"> 
           <input type="text" id="Text1" name="tpty" value="bztp" style="display:none" />
            <input type="text" id="submittype" name="submittype" value="bztp" style="display:none" />
           <input type="text" id="bzcount2" name="bzcount" value="1" style="display:none" />
             <input type="text" id="alterlist" name="alterlist" value="1" style="display:none" />
           <input type="text" id="bztppath" name="bztppath" value="" style="display:none" />
             <input type="text" id="cptppath" name="cptppath"  value="" style="display:none" />
             <input type="text" id="menunumber2" name="menunumber2"  value="" style="display:none" />
              <input type="text" id="usernumber2" name="usernumber2"  value="" style="display:none" />
        <div class="buzhouslt" id="buzhouslt">   
             <!-- <input type="file" name="File" id="File" /> 
              <input type="file" name="File1" id="File2" />-->

             <div class="bzsltitem" onclick="addbuzhou()"> 
                <img src="add.jpg"   />
                
            </div>
        </div>
           </form>


         <div class="cpxxtp">
    <!--图片类型验证方法1-->
             <div class="cpbztp">

                <!--  <input type="file" id="buzhou" accept="image/*" />-->
    <!--<input type="button" id="btn1" value="点击上传" onclick="uploadClick();" />-->
   <!-- <h4>选择文件如下:</h4>-->
    <img src="tp.jpg" id="buzhouimg" />

             </div>
         <!-- <input type="button" class="bzconfirm"  onclick="buzhouconfirm()" value="确认" />-->
                <textarea id="buzhoujs" placeholder="步骤介绍"> </textarea>
       </div>
     
		<a href="#" class="button back">Back</a>
		<a href="#" class="button finish">Next!</a>
    </div>
</div>

<div class="step" id="step3">
    <div class="section">
        <h1>Step 3</h1>
        <!--<p>welcome to 16sucai.com</p>-->
        <div class="results"></div>
        <a href="#" class="button again">Again</a>
        
         <a href="#" class="button finish" onclick="upload()">上传菜谱信息</a>
    </div>
</div>  


    <div class="login-form2"  >
      <div class="alertconfirm2" id="Div2" onclick="conti()">继续制作</div>
      <div class="alertconfirm2" id="Div3" onclick="notconti()">返回</div>
</div>
<div class="login-form-mask2"></div>
    <div id="js">
       <!-- <script>

            var foodname = document.getElementById("name");
            var foodmaterials = document.getElementById("sc");
            var foodtype = document.getElementById("type");
            var foodintroduce = document.getElementById("introduce");
            //  var foodpicture = result;

            foodname.value = "红烧肉";
            foodmaterials.value = "肉";
            foodtype.value = "菜";
            foodintroduce.value = "好吃";
        </script>-->

    </div>  
<script src="jquery1_4_2.min.js"></script>
<script src="md5.js"></script>
<script src="script.js"></script>
    <script>
        var inputflag = "";
        var presentmenubzid = 0;
        var bzsl = 0;
        var menunumber = "";
        var bztppath = "";
        var cptppath = "";
        var usernumber = "";
        var useractype = "";
        var basic = new Array();
        var title = document.getElementById('subtitle');

        $().ready(function () {
            menunumber = decodeURI(GetQueryString("menunumber"));
          //  alert(menunumber);
            if (menunumber != "non" && menunumber != "dnon") {
                //  alert("dffdmenunumber:" + menunumber);
                useractype = "edit";
                pageload(menunumber);
                $('#submittype').val("edit");
            } else if (menunumber == "dnon") {
                $('.login-form-mask2').fadeIn(100);
                $('.login-form2').slideDown(200);
                // alert("menunumber:" + menunumber);
                createmenunumber();
                useractype = "add";
                $('#submittype').val("add");
            } else if (menunumber == "non") {
                createmenunumber();
                useractype = "add";
                $('#submittype').val("add");
            }
            
          

            title.innerText = "输 入 基 本 菜 品 信 息";
           
           
            //usernumber = decodeURI(GetQueryString("usernumber"));
            islogin();
           // var  cyt = decodeURI(GetQueryString("cyt"));
            //usernumber = decodeURI(GetQueryString("usernumber"));
            
            // sessionStorage.setItem('usernumber','001');

            //document.getElementById("username").innerText = decodeURI(GetQueryString("username"));
            //getlist(1, "001");
            getbasic(); 
           // alert(menunumber);
           
               
            // $.post('../ashx/Index.ashx');
        });
         

        function deletestep() {
            if (presentmenubzid == 0) {
                alert("未选择步骤");
            } else {
                if (confirm("你确定删除第" + presentmenubzid + "步吗？")) {

                    var h = "bz" + presentmenubzid;
                    var a = document.getElementById(h);
                    a.parentNode.removeChild(a);
                    for (var i = presentmenubzid; i < bzsl; i++) {
                        var k = i + 1;
                        var nalbzid = "bz" + i;
                        var nalbztpuploadfileid = "bztpuploadfile" + i;
                        var nalbzjsid = "bzjs" + i;
                        var nalbztpid = "bztp" + i;

                        var albztpid = "bztp" + k;
                        var albzid = "bz" + k;
                        var albztpuploadfileid = "bztpuploadfile" + k;
                        var albzjsid = "bzjs" + k;
                        var onclickf = "editbuzhou(" + i + ")"


                        document.getElementById(albztpid).setAttribute('id', nalbztpid);
                        document.getElementById(albzid).setAttribute('id', nalbzid);
                        document.getElementById(nalbzid).setAttribute('onclick', onclickf);
                        document.getElementById(albztpuploadfileid).setAttribute('id', nalbztpuploadfileid);
                        document.getElementById(nalbztpuploadfileid).setAttribute('name', nalbztpuploadfileid);
                        document.getElementById(albzjsid).setAttribute('id', nalbzjsid);
                        document.getElementById(nalbzjsid).innerText = "第" + i + "步";
                    }

                    bzsl--;
                    presentmenubzid--;

                }

            }

        }
        //判断是否登录
        function islogin() {
            $.post('../../ashx/UserHandler.ashx?type=getaccount', function (msg) {
                if (msg != "") {
                    // $('#userbriefinfo').html(msg);
                    usernumber = msg;
                   // userlogintrue = "true";
                }

            });
        }
        function notconti() {
            $('.login-form-mask2').fadeOut(100);
            $('.login-form2').slideUp(200);
            window.location = "../index2/index.html";
        }
        function conti() {
            $('.login-form-mask2').fadeOut(100);
            $('.login-form2').slideUp(200);
            createmenunumber();
        }
        function backto() {

            window.location = " ../index2/index.html";
        }
        function insertstep() {


            var val = $('#insertstepid').val();

            if (val <= 0 || val > bzsl + 2) {
                alert("不合理的值");
                return;
            }
            var bztpid = "bztp" + val;
            var bztpuploadid = "bztpuploadfile" + val;
            var h = "<div class='bzsltitem' id='bz" + val + "' onclick='editbuzhou(" + val + ")' >  ";
            h += "<input type='file' name='" + bztpuploadid + "' id='" + bztpuploadid + "' accept='image/*' class='addbztpaa' />  ";
            h += "<img src='tp.jpg' id='" + bztpid + "'  /><p id='bzjs" + val + "'>第" + val + "步</p>   </div>";

            var buzhouslt = document.getElementById("buzhouslt");

            for (var i = bzsl; i >= val; i--) {
                var k = i + 1;
                var nalbzid = "bz" + i;//原来id
                var nalbztpuploadfileid = "bztpuploadfile" + i;
                var nalbzjsid = "bzjs" + i;
                var nalbztpid = "bztp" + i;

                var albztpid = "bztp" + k;//改变id
                var albzid = "bz" + k;
                var albztpuploadfileid = "bztpuploadfile" + k;
                var albzjsid = "bzjs" + k;

                var onclickf = "editbuzhou(" + k + ")";
                console.log(bzsl);
                document.getElementById(nalbzid).setAttribute('id', albzid);
                document.getElementById(albzid).setAttribute('onclick', onclickf);

                document.getElementById(nalbztpuploadfileid).setAttribute('id', albztpuploadfileid);
                document.getElementById(albztpuploadfileid).setAttribute('name', albztpuploadfileid);

                document.getElementById(nalbzjsid).setAttribute('id', albzjsid);

                document.getElementById(nalbztpid).setAttribute('id', albztpid);

                document.getElementById(albzjsid).innerText = "第" + k + "步";
            }

            if (val > 1 && val <= bzsl) {
                var gg = "bz" + (val - 1);
                var ind = document.getElementById(gg);
                $('#buzhouslt').prepend(h);
                var idt = "bz" + val;
                var tep = document.getElementById(idt);
                buzhouslt.insertBefore(tep, ind);
            } else if (val == bzsl + 1) {
                $('#buzhouslt').prepend(h);
            } else if (val == 1) {
                var first = document.getElementById("addstep");
                $('#buzhouslt').prepend(h);
                var tep = document.getElementById("bz1");
                buzhouslt.insertBefore(tep, first);
                // $('#buzhouslt').prepend(h);
            }

            var js = "var  " + bztpuploadid + "= document.getElementById('" + bztpuploadid + "');"
            js = js + bztpuploadid + ".onchange = function () {  var fileList = " + bztpuploadid + ".files;";
            js += "for (var i = 0; i < fileList.length; i++) { var file = fileList[i]; ";
            // js+=" if (/image\/\w+/.test(file.type)) { 
            js += " var reader = new FileReader();     reader.readAsDataURL(file);";
            js += "    reader.onload = function (e) {   ";
            js += "result = reader.result;   $('.container blockquote').text(result);";
            js += "   $('#" + bztpid + "').attr('src', result); $('#buzhouimg').attr('src', result);  var hh = 'bzjs' + bzsl; var t=document.getElementById(hh).innerText;  $('#buzhoujs').val(t);  }}}";
            //alert(js);
            var script = document.createElement("script");
            script.type = "text/javascript";
            script.text = js;
            document.body.appendChild(script);
            // $('#buzhouimg').attr('src', result);
            var hh = 'bzjs' + bzsl; var t = document.getElementById(hh).innerText; $('#buzhoujs').val(t);
            bzsl++;
        }

        function mianscisnull() {
            var re2 = /^[-\s\w\u4e00-\u9fa5]{1,15}$/;//只能输入汉字和英文字母空格3-15位 
            var re3 = /^[0-9]{0,5}$/;//只能输入数字 
            var mainsc = $('#addmainsc').val();
            mainsc = mainsc.replace(/\s+/g, "");
            var mainscingredientval = $('#mainscingredientval').val();
            mainscingredientval = mainscingredientval.replace(/\s+/g, "");
            var mainscunit = $('#mainscunit').val();
            mainscunit = mainscunit.replace(/\s+/g, "");
            if (mainsc == "") {
                alert("未选择主食材");
                $('#mainsc').focus;
                inputflag = "false";
            } else if (!re2.test(mainsc)) {
                alert("不能含有特殊字符");
                $('#addmainsc').focus;
                inputflag = "false";
            } else if (!re3.test(mainscingredientval)) {
                alert("只能输入不大于5位的数字");
                $('#mainscingredientval').focus;
                inputflag = "false";
            } else if (!re2.test(mainscunit)) {
                alert("不能含有特殊字符");
                $('#mainscunit').focus;
                inputflag = "false";
            } else {
                inputflag = "true";
            }


        }
         
        function createmenunumber() {
           // usernumber = "hhhh";
            var now = new Date();
            var year = now.getFullYear(); //得到年份
            var month = now.getMonth();//得到月份
            var date = now.getDate();//得到日期
            var minu = now.getMinutes();//得到分钟
            var sec = now.getSeconds();//得到秒
            var reg = new RegExp('"', "g");
            menunumber = menunumber.replace(reg, "");
            
             menunumber = usernumber + date + minu + sec;//作为菜谱编号 
            bztppath = "userproduction/" + usernumber + "/" + menunumber + "/steps/";//单个步骤图片
            //alert("bztppath" + bztppath);
          //  alert(menunumber);
            $('#bztppath').val(bztppath);
            document.getElementById('bztppath').value = bztppath;
            cptppath = "userproduction/" + usernumber + "/" + menunumber + "/";//单个步骤图片
            //alert("cptppath" + cptppath);
            $('#cptppath').val(cptppath);
            $('#usernumber').val(usernumber);
            $('#usernumber2').val(usernumber);
            $('#menunumber').val(menunumber);
            $('#menunumber2').val(menunumber);
             
           // document.getElementById('cptppath').value = cptppath;
        }
        function  miansccheck() {
            var re2 = /^[-\s\w\u4e00-\u9fa5]{1,15}$/;//只能输入汉字和英文字母空格3-15位 
            var re3 = /^[0-9]{0,5}$/;//只能输入数字 
            var mainsc = $('#addmainsc').val();
            mainsc = mainsc.replace(/\s+/g, "");
            var mainscingredientval = $('#mainscingredientval').val();
            mainscingredientval = mainscingredientval.replace(/\s+/g, "");
            var mainscunit = $('#mainscunit').val();
            mainscunit = mainscunit.replace(/\s+/g, "");
            if (mainsc == "") {
                alert("未选择主食材");
                $('#mainsc').focus;
                inputflag = "false";
            }else if (!re2.test(mainsc)) {
                alert("不能含有特殊字符");
                $('#addmainsc').focus;
                inputflag = "false";
            } else if (!re3.test(mainscingredientval)) {
                alert("只能输入不大于5位的数字");
                $('#mainscingredientval').focus;
                inputflag = "false";
            } else if (!re2.test(mainscunit)) {
                alert("不能含有特殊字符");
                $('#mainscunit').focus;
                inputflag = "false";
            } else {
                inputflag = "true";
            }

            
        }
        function flcheck() {
            var re2 = /^[-\s\w\u4e00-\u9fa5]{1,15}$/;//只能输入汉字和英文字母空格3-15位
            var re3 = /^[0-9]{1,5}$/;//只能输入数字
            var addfl = $('#addfl').val();
            addfl = addfl.replace(/\s+/g, "");
            var flingredientval = $('#flingredientval').val();
            flingredientval = flingredientval.replace(/\s+/g, "");
            var flunit = $('#flunit').val();
            flunit = flunit.replace(/\s+/g, "");
            if (addfl == "") {
                alert("未选择辅料");
                $('#addfl').focus;
                inputflag = "false";
            } else if (!re2.test(addfl)) {
                alert("不能含有特殊字符");
                $('#addfl').focus;
                inputflag = "false";
            } else if (!re3.test(flingredientval)) {
                alert("只能输入不大于5位的数字");
                $('#flingredientval').focus;
                inputflag = "false";
            } else if (!re2.test(flunit)) {
                alert("不能含有特殊字符");
                $('#flunit').focus;
                inputflag = "false";
            } else {
                inputflag = "true";
            }
        }
        function elsecheck() {
            var re2 = /^[-\s\w\u4e00-\u9fa5]{1,15}$/;//只能输入汉字和英文字母空格3-15位
             
            var menuname = $('#menuname').val(); menuname = menuname.replace(/\s+/g, "");
            //var menuimg = document.getElementById('menuimg').src; flunit = flunit.replace(/\s+/g, "");
            var kw = $('#kw').val(); kw = kw.replace(/\s+/g, "");
            var gy = $('#gy').val(); gy = gy.replace(/\s+/g, "");
            var menutype = $('#menutype').val(); menutype = menutype.replace(/\s+/g, ""); 
            var introduce = $('#introduce').val(); introduce = introduce.replace(/\s+/g, "");
            var Tips = $('#Tips').val(); Tips = Tips.replace(/\s+/g, "");
            var mainsc = $('#mainsc').val();
            var  fl = $('#fl').val();
            if (mainsc == "") {
                alert("还没添加食材");
                $('#menuname').focus;
                inputflag = "false";
            //} else if (fl == "") {
            //    alert("还没给菜谱命名");
            //    $('#menuname').focus;
            //    inputflag = "false";
            //} else if (menuname == "") {
                alert("还没给菜谱命名");
                $('#menuname').focus;
                inputflag = "false";
            } else if (!re2.test(menuname)) {
                alert("不能含有特殊字符");
                $('#menuname').focus;
                inputflag = "false";
            } else if (kw == "") {
                alert("还没选择口味");
                $('#kw').focus;
                inputflag = "false";

            } else if (!re2.test(kw)) {
                alert("不能含有特殊字符");
                $('#kw').focus;
                inputflag = "false";
            } else if (gy == "") {
                alert("还没选择工艺");
                $('#gy').focus;
                inputflag = "false";

            } else if (!re2.test(gy)) {
                alert("不能含有特殊字符");
                $('#gy').focus;
                inputflag = "false";
            } else if (menutype == "") {
                alert("还没选择菜谱类型");
                $('#menutype').focus;
                inputflag = "false";

            } else if (!re2.test(menutype)) {
                alert("不能含有特殊字符");
                $('#menutype').focus;
                inputflag = "false";
            } else if (introduce == "") {
                alert("还没填写菜谱介绍");
                $('#introduce').focus;
                inputflag = "false";
            } else if (!re2.test(introduce)) {
                alert("不能含有特殊字符");
                $('#introduce').focus;
                inputflag = "false";
            } else if (!re2.test(Tips)) {
                alert("不能含有特殊字符");
                $('#Tips').focus;
                inputflag = "false";
            } else {
                inputflag = "true";
            }
            
        }
        function inputcheck(ty) {
            var hx = document.getElementById('file1').value;
            if (hx == "") {
                console.log("封面图片未修改");
            }
            var re2 = /^[-\s\w\u4e00-\u9fa5]{3,15}$/;//只能输入汉字和英文字母空格3-15位 
             
            if (ty == "main") {
                 miansccheck();
                 //inputflag = "true";
            } else if (ty == "fl") {
                 flcheck();
            } else if (ty == "all") {
                
                elsecheck();
               // miansccheck();
               // flcheck();
                //if (inputflag=="false") {
                //    document.getElementById("step1next").onclick = function (e) {
                //        e.preventDefault();
                //    }
                //} 
            }
           
           
             
        }
        function addingredient(sctype) {
              inputcheck(sctype);
              //alert(inputflag);
              if (sctype == "main" && inputflag == "true") {
                var h = $('#mainsc').val();
                var mainsc = $('#addmainsc').val(); 
                mainsc = mainsc.replace(/\s+/g, "");
                var mainscingredientval = $('#mainscingredientval').val();
                mainscingredientval = mainscingredientval.replace(/\s+/g, "");
                var mainscunit = $('#mainscunit').val();
                mainscunit = mainscunit.replace(/\s+/g, "");

                if (h == "") {
                    h = mainsc + "|" + mainscingredientval + "|" + mainscunit;
                } else {
                    h = h + "," + mainsc + "|" + mainscingredientval + "|" + mainscunit;
                }
                
                $('#mainsc').val(h);
               
              } else if (sctype == "fl" && inputflag == "true") {
                var h = $('#fl').val();

                var addfl = $('#addfl').val();
                addfl = addfl.replace(/\s+/g, "");
                var flingredientval = $('#flingredientval').val();
                flingredientval = flingredientval.replace(/\s+/g, "");
                var flunit = $('#flunit').val();
                flunit = flunit.replace(/\s+/g, "");
               
                if (h == "") {
                    h = addfl + "|" + flingredientval + "|" + flunit;
                } else {
                    h = h + "," + addfl + "|" + flingredientval + "|" + flunit;
                }
                $('#fl').val(h);
                      
            }

        }
        function editbuzhou(val) {
            presentmenubzid = val;
            var bzjs = "bzjs" + val;
            var bztp = "bztp" + val;

            var h = document.getElementById(bztp).src;
            var bzjsa = document.getElementById(bzjs).innerText;
            //alert(bzjsa);
            $('#buzhoujs').val(bzjsa);
           // var bztpa = document.getElementById(bztp).src;
            $('#buzhouimg').attr('src',h);

        }
     
        function buzhouconfirm() {
            //bzsl++; 
            var bzjs = $('#buzhoujs').val();
            var hh = "bzjs" + bzsl;
            document.getElementById(hh).innerText=bzsl+"."+bzjs;
            var bztpid="bztp"+bzsl;
            var bztpuploadid="bztpuploadfile"+bzsl;
            //var h = " <div class='bzsltitem' onclick='editbuzhou("+bzsl+")' >  <input type='file' id='"+bztpuploadid+"' accept='image/*' />  <img src='tp.jpg' id='"+bztpid+"'  /><p id='bzjs"+bzsl+"'> "+bzjs+"</p>   </div>";
           // $('#buzhouslt').append(h);
          //  var buzhou = document.getElementById('buzhou'); 
           // var fileList = buzhou.files;
            //document.getElementById(bztpuploadfile1)
           // alert(fileList);
            //for (var i = 0; i < fileList.length; i++) {
             //   var file = fileList[i];
                //图片类型验证第二种方式
               // if (/image\/\w+/.test(file.type)){
               //     var reader = new FileReader();
                //    reader.readAsDataURL(file);
                //    reader.onload = function (e) {
                 //       result = reader.result;

                  //      $('.container blockquote').text(result);
                       // alert(result);
                   //     document.getElementById(bztpid).setAttribute('src', result);
                        //document.getElementById(bztpuploadfile1);
                        //$('#"+bztpid+"').attr('src', result);
                        // $('#img1').attr('src', result)
                 //   }
               // }
                    
              //  else
                 //   console.log(file.name + ':不是图片');
           // }

            $('#buzhoujs').val("");
            $('#buzhouimg').attr('src','tp.jpg');
            
            


        }
        function addbuzhou() {
            bzsl++;
            $('#bzcount2').val(bzsl);
            //alert($('#bzcount2').val());
            presentmenubzid = bzsl;
            //var bzjs=$('#buzhoujs').val();
            var bztpid="bztp"+bzsl;
            var bztpuploadid="bztpuploadfile"+bzsl;
            var h = "<div class='bzsltitem'  id='bz" + bzsl + "' onclick='editbuzhou(" + bzsl + ")' >  ";
            h += "<input type='file' name='" + bztpuploadid + "' id='" + bztpuploadid + "' accept='image/*' class='addbztpaa' />  ";
            h+="<img src='tp.jpg' id='" + bztpid + "'  /><p id='bzjs" + bzsl + "'>第"+bzsl+"步</p>   </div>";
            
            $('#buzhouslt').prepend(h);
            
            var js = "var  " + bztpuploadid + "= document.getElementById('" + bztpuploadid + "');"
            js = js + bztpuploadid + ".onchange = function () {  var fileList = " + bztpuploadid + ".files;";
            js+="for (var i = 0; i < fileList.length; i++) { var file = fileList[i]; ";
            // js+=" if (/image\/\w+/.test(file.type)) { 
            js += " var reader = new FileReader();     reader.readAsDataURL(file);";
            js+="    reader.onload = function (e) {   ";
            js += "result = reader.result;   $('.container blockquote').text(result);";  
            js += "   $('#" + bztpid + "').attr('src', result); $('#buzhouimg').attr('src', result);  var hh = 'bzjs' + bzsl; var t=document.getElementById(hh).innerText;  $('#buzhoujs').val(t);  }}}";
            //alert(js);
            var script = document.createElement("script");
            script.type = "text/javascript";
            script.text = js;
            document.body.appendChild(script);
            // $('#buzhouimg').attr('src', result);
            var hh = 'bzjs' + bzsl; var t = document.getElementById(hh).innerText; $('#buzhoujs').val(t);
            
        }
        $('#buzhoujs').bind('input propertychange', function () {
            ///console.info('值在改变:' + $(this).val());
            var p = "第" + presentmenubzid+"步";
            var pp = "bzjs" + presentmenubzid;
            // var presentmenujs = document.getElementById(pp).innerText;
            
            document.getElementById(pp).innerText = $(this).val();
            var str = $(this).val();
            str = str.replace(/\s+/g, "");
            var x = $(this);
            
            setTimeout(function () {
                if (str == "") {  
                   // x.val(p);
                    document.getElementById(pp).innerText = p;  
                }
            }, 1000);
             
        });

        
        function setval(type, val) {
             
            if (type == "kw") {
                $('#kw').val(val);
            } else if (type == "gy") {
                $('#gy').val(val);
            } else if (type == "type") {
                $('#menutype').val(val);
            } else if (type == "mainsc") {
                $('#addmainsc').val(val);
                
            } else if (type == "fl") {
                $('#addfl').val(val);
                
            }

            alertcancle();
        }
        function changgeIT(val) {
            if (val == "I") {
                $('#introduce').css({ "display": "block" });
                $('#Tips').css({ "display": "none" });
            } else {
                $('#introduce').css({ "display": "none" });
                $('#Tips').css({ "display": "block" });
            }
        }
        function getaa(val) {
            //alert(val);
            //alert(basic);
            $('#basic').html(basic[val]);
            popUserInfoBox();
        }
       // onclick = "getaa('kw')"
        function getbasic() {
           
            $.post('../ashx/UserHandler.ashx?type=getbasic', function (msg) {
                
                basic = msg.split('$');//  0 口味 1 工艺 2食材 3 类型 4 辅料  

            })
           

        }
        function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return (r[2]); return null;
        }
        /*点击弹出用户界面*/
        function popUserInfoBox() {

            //  var popBox = document.getElementById("popBox");
            // var popLayer = document.getElementById("popLayer");
            // popBox.style.display = "block";
            // popLayer.style.display = "block";





            $('.login-form-mask').fadeIn(100);
            $('.login-form').slideDown(200);

        };

        /*点击关闭用户界面*/
        function closeUserInfoBox() {
            //var popBox = document.getElementById("popBox");
            // var popLayer = document.getElementById("popLayer");
            // popBox.style.display = "none";
            // popLayer.style.display = "none";
        }
        function alertcancle() {
            $('.login-form-mask').fadeOut(100);
            $('.login-form').slideUp(200);
        }

        function alertconfirm() {
            alertcancle();
            // window.location = "../../login-reister/index.html";
        }
        function pageload(menunumber) {
            //alert("dsfdsfa");
            $('#menunumber2').val(menunumber);
            $.post('../ashx/UserHandler.ashx?type=getSingleUserMenu&MenuNumber='+menunumber, function (msg) {
             
                var  MenuName="";var  Type=""; var  Introduce=""; var  CoverImg="";var  Collection="";
                var  Account="";var  Tips="";var  MenuMainIngredient=""; var  MenuFuliao=""; var  MenuGY="";
                var  MenuKW="";var  MenuSteps="";var  TimeMade=""; var  status="";
                //var MenuND = "";

                var h = new Array();

                h = msg.split('，');
                console.log(h);
                for (var i = 0; i < h.length; i++) {
                    var k = h[i].split(':');
                    if (k[0] == "MenuName") {
                        MenuName = k[1];
                        $('#menuname').val(k[1]);
                    } else if (k[0] == "Type") {
                        Type = k[1];
                        $('#menutype').val( k[1]);
                    } else if (k[0] == "Introduce") {
                        Introduce = k[1];
                        $('#introduce').val(k[1]);
                    } else if (k[0] == "CoverImg") {
                        CoverImg = k[1];
                        document.getElementById('menuimg').src = "../../images/" + k[1];
                    } else if (k[0] == "Tips") {
                        Tips = k[1];
                        $('#Tips').val( k[1])
                    } else if (k[0] == "MenuMainIngredient") {
                        MenuMainIngredient = k[1];
                        var mainsc = $('#mainsc').val(k[1]);
                        $('#mainsc').attr('disabled', 'none');
                        $('#mainsc').removeAttr('disabled');
                    } else if (k[0] == "MenuFuliao") {
                        MenuFuliao = k[1];
                        $('#fl').attr('disabled', 'none');
                        $('#fl').removeAttr('disabled');
                        $('#fl').val(k[1]);
                    } else if (k[0] == "MenuGY") {
                        MenuGY = k[1];
                        $('#gy').val(k[1]);
                    } else if (k[0] == "MenuKW") {
                        MenuKW = k[1];
                        $('#kw').val( k[1]);
                    } else if (k[0] == "MenuSteps") {
                        MenuSteps = k[1];
                    } 
                }
                
                var menustep = MenuSteps.split('$');
                var  bzle = menustep.length;
                $('#bzcount2').val(bzle);
                bzsl = bzle;
                console.log(menustep);
                console.log(menustep.length);
                for (var i = 0; i < menustep.length; i++) {
                    var k = i + 1; 
                    var dd = menustep[i].split('#');
                    console.log("步骤介绍"+k+":"+dd[0]);
                    console.log("图片地址" + k + ":" + dd[1]);
                    if (i == 0) {
                        $('#buzhoujs').val(dd[0]);
                        $('#buzhouimg').src = "../../images/" + dd[1];
                        // val(dd[1]); 
                    }
                    var bztpid = "bztp" + k;
                    var bztpuploadid = "bztpuploadfile" + k;
                    var h = "<div class='bzsltitem'  id='bz" + k + "' onclick='editbuzhou(" + k + ")' >  ";
                    h += "<input type='file' name='" + bztpuploadid + "' id='" + bztpuploadid + "' accept='image/*' class='addbztpaa' />  ";
                    h += "<img src='../../images/" + dd[1] + "' id='" + bztpid + "'  /><p id='bzjs" + k + "'>" + dd[0] + "</p>   </div>";

                    $('#buzhouslt').prepend(h);
                    var js = "var  " + bztpuploadid + "= document.getElementById('" + bztpuploadid + "');"
                    js = js + bztpuploadid + ".onchange = function () {  var fileList = " + bztpuploadid + ".files;";
                    js += "for (var i = 0; i < fileList.length; i++) { var file = fileList[i]; ";
                    // js+=" if (/image\/\w+/.test(file.type)) { 
                    js += " var reader = new FileReader();     reader.readAsDataURL(file);";
                    js += "    reader.onload = function (e) {   ";
                    js += "result = reader.result;   $('.container blockquote').text(result);";
                    js += "   $('#" + bztpid + "').attr('src', result); $('#buzhouimg').attr('src', result);  var hh = 'bzjs' + bzsl; var t=document.getElementById(hh).innerText;  $('#buzhoujs').val(t);  }}}";
                    //alert(js);
                    var script = document.createElement("script");
                    script.type = "text/javascript";
                    script.text = js;
                    document.body.appendChild(script);
                   
                }
             
               
              
                //http://localhost:1516/Frontdesk/MadeMenu/MadeMenu.html?menunumber=14357&usernumber=undefined
                




               
                // $('#buzhouimg').attr('src', result);
               // var hh = 'bzjs' + bzsl; var t = document.getElementById(hh).innerText; $('#buzhoujs').val(t);
              
                
                 
              //  var h = "{'hh':'hh','gg':'gg'}";
               // var n = JSON.parse(h);
              //  var le = n.length;
               // var lee = msg.length;
              //  var menuname = n[0].MenuName;
              //  alert("n:" + n + "le:" + le + "lee:" + lee);
                title.innerText = "菜 品 信 息 编 辑";





               // $('#js').html(msg);
                //$.post('../ashx/UserHandler.ashx?type=getUserMenu&UserNumber='+usernumber+'&Size='+size+'&MenuNumber='+menunumber, function (msg) {
          

            })
            //$.post('../ashx/UserHandler.ashx?type=UserProductionedit&userfoodnumber=' + userfoodnumber, function () {



            //})

        }
       
        //function  imgcheck(file) {
        //    if (/image\/\w+/.test(file.type)){
        //        var reader = new FileReader();
        //        reader.readAsDataURL(file);
        //        reader.onload = function (e) {
        //            result = reader.result;
        //            return 
        //            $('.container blockquote').text(result);
        //            $('#buzhouimg').attr('src', result);
        //            // $('#img1').attr('src', result)
        //        }
        //    }
        //        //     readFile(file);
        //    else
        //        console.log(file.name + ':不是图片');
        
        //}
       // var bzimg = document.getElementById('buzhou');
      //  bzimg.onchange = function () {
            //获取选择文件的数组
          //  var fileList = bzimg.files;
          //  for (var i = 0; i < fileList.length; i++) {
             //   var file = fileList[i];
                //图片类型验证第二种方式
             //   if (/image\/\w+/.test(file.type)){
              //      var reader = new FileReader();
              //      reader.readAsDataURL(file);
              //      reader.onload = function (e) {
              //          result = reader.result;
        //
                 //       $('.container blockquote').text(result);
                 //       $('#buzhouimg').attr('src', result);
                        // $('#img1').attr('src', result)
                 //   }
             //   }
               //     readFile(file);
             //   else
               //     console.log(file.name + ':不是图片');
           // }
       // }
        //读取图片实例,并上传到服务器
        var result = "";//图片
        //var fileBox = document.getElementById('file');
        
        //fileBox.onchange = function () {
        //    //获取选择文件的数组
        //    var fileList = fileBox.files;
        //    for (var i = 0; i < fileList.length; i++) {
        //        var file = fileList[i];
        //        //图片类型验证第二种方式
        //        if (/image\/\w+/.test(file.type))
        //            readFile2(file);
        //        else
        //            console.log(file.name + ':不是图片');
        //    }
        //}
        ////读取二进制图片文件，并上传到服务器
        //function uploadClick() {
        //    var fileList = fileBox.files;
        //    for (var i = 0; i < fileList.length; i++) {
        //        var file = fileList[i];
        //        //图片类型验证第二种方式
        //        if (/image\/\w+/.test(file.type))
        //            uploadFile(file);
        //        else
        //            console.log(file.name + ':不是图片');
        //    }
        //}
        var menuimg = document.getElementById('file1');
        menuimg.onchange = function () {
            //获取选择文件的数组
          
            var fileList = menuimg.files;
            for (var i = 0; i < fileList.length; i++) {
                var file = fileList[i];
                //图片类型验证第二种方式
                if (/image\/\w+/.test(file.type))
                    readFile(file);
                else
                    console.log(file.name + ':不是图片');
            }
        }
        //读取二进制图片文件，并上传到服务器
        
        //关键代码上传到服务器
        function test() {
            var cptp = document.getElementById("cptp");
            var form = document.getElementById("cptp");
            var formData = new FormData(form);
            $.ajax({
                url: '../../ashx/Handler2.ashx',
                type: 'POST',
                data: formData,                    // 上传formdata封装的数据
                dataType: 'JSON',
                cache: false,                      // 不缓存
                processData: false,                // jQuery不要去处理发送的数据
                contentType: false,                // jQuery不要去设置Content-Type请求头
                success: function (data) {           //成功回调
                    console.log(data);
                }
            });
            //var xhr = new XMLHttpRequest();
            //xhr.open("post", "../../ashx/Handler2.ashx");
            //xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            //xhr.send(formData);
           // cptp.submit();
        }
        function readFile2(file) {
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function (e) {
                result = reader.result;

                $('.container blockquote').text(result);
                $('#buzhouimg').attr('src', result);
                // $('#img1').attr('src', result)
            }
        }
        //读取图片内容 为DataURL
        function readFile(file) {
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function (e) {
                 result = reader.result;
                 
                 $('.container blockquote').text(result);
               // alert(result)
                $('#menuimg').attr('src', result);
               // $('#img1').attr('src', result)
            }
        }

        function submiteditimg() {
            console.log("修改菜谱");
            var hh = document.getElementById("hh");
            var vv = "";
            var hx = document.getElementById('file1').value;
            if (hx != "") {
                var cptp = document.getElementById("file1");
                vv = "0";
                console.log("cp图片修改");
                hh.appendChild(cptp);
            } else {
                console.log("cp图片未修改");
            }
            //var cptp = document.getElementById("file1");
           for (var i = 1; i <= bzsl; i++) {
                var id = "bztpuploadfile" + i;
                var hit=document.getElementById(id);
                if (hit.value == "") {
                    console.log("步骤图片"+i+"修改");
                    hit.parentNode.removeChild(hit);
                } else {
                    vv += "," + i;
                    console.log("步骤图片" + i + "未修改");
                }
               
           }
           $('#alterlist').val(vv);
           $('#submittype').val("edit");
           console.log("alterlist:" + $('#alterlist').val());
                setTimeout(function () { 
                    hh.submit();
                }, 5000)
            
        }
       
        function submitimg() {
            //alert($('#menuimg').attr('src'));
            var p = "true";
            if ($('#menuimg').attr('src') == "tp.jpg") {
                alert("未设置菜谱图片");
                p = "false";
            }
            for (var i = 1; i <= bzsl; i++) {
                var h="bztp"+i;
                var c=document.getElementById(h).src;
                if (c == "tp.jpg") {
                    alert("步骤" + i + "未添加图片");
                    p = "false";
                }
               
            } 
            if (p == "true") { 
               // setTimeout(function () {
                  //  var cptp = document.getElementById("cptp");
                   
                    //cptp.submit();
                    // alert("aaaaaaa");
              //  }, 1000);
                setTimeout(function () {
                    var cptp = document.getElementById("file1");
                    var hh = document.getElementById("hh");
                    hh.appendChild(cptp);
                    hh.submit();
                },5000)
            }
           
        }

        function checkgrade() {
            $.post('../ashx/UserHandler.ashx?type=checkgrade', function (msg) {
                if (msg == "upgrade") {
                    alert("等级提升");
                }
                
            })
            
        }
        //提交数据
        function upload() {
           
            inputcheck('all');
          
           
            var menuname= $('#menuname').val();
            var menuimg= document.getElementById('menuimg').src;
            var kw= $('#kw').val();
            var gy= $('#gy').val();
            var menutype= $('#menutype').val();
            var mainsc= $('#mainsc').val();
            var fl= $('#fl').val();
            var introduce = $('#introduce').val();
            var Tips = $('#Tips').val();

            //var menunumber = "";
           /// bztppath = "";
            //var cptppath = "";
           
            
            var bzjs = "";//单个步骤介绍
            var bztp ="userproduction/" + usernumber + "/" + menunumber+"/"  ;//单个步骤图片
            var bzall = ""; 
            var bztpa = "";
            var bztppath = "";
            for (var i = 1; i <= bzsl; i++) {
                 var bzjsid = "bzjs"+i;//步骤介绍id
                bzjs = document.getElementById(bzjsid).innerText;
               
                bztppath = bztp + "steps/" + i + ".jpg";
                if(i==1){
                    bzall = bzjs + '#' + bztppath + '$';
                } else if(i==bzsl){
                    bzall = bzall + bzjs + '#' + bztppath;
                }else { 
                    bzall = bzall + bzjs + '#' + bztppath + '$';
                } 
            }
            var menuimg = bztp + "cp.jpg";
           // alert(bzall);
            if (useractype == "edit") {
                console.log(useractype);

                $.post('../ashx/UserHandler.ashx?type=UserProductionUpdate&menuname=' + menuname + '&kw=' + kw + '&gy=' + gy + '&menutype=' + menutype + '&mainsc=' + mainsc + '&fl=' + fl + '&introduce=' + introduce + '&Tips=' + Tips + '&menunumber=' + menunumber + '&menuimg=' + menuimg + '&bzall=' + encodeURIComponent(bzall), function (msg) {
            
                  //  $.post('../ashx/UserHandler.ashx?type=UserProductionSteps&menunumber=' + menunumber + '&bzall=' + encodeURIComponent(bzall), function (msg) {
                         
                            setTimeout(function () {
                                submiteditimg();
                            }, 1000) 
                    //})
                })

            }else if(useractype == "add"){ 
                    $.post('../ashx/UserHandler.ashx?type=UserProduction&menuname=' + menuname + '&kw=' + kw + '&gy=' + gy + '&menutype=' + menutype + '&mainsc=' + mainsc + '&fl=' + fl + '&introduce=' + introduce + '&Tips=' + Tips + '&menunumber=' + menunumber + '&menuimg=' + menuimg + '&bzall=' + encodeURIComponent(bzall), function (msg) {
 
                        $.post('../ashx/UserHandler.ashx?type=UserProductionSteps&menunumber=' + menunumber + '&bzall=' + encodeURIComponent(bzall), function (msg) {

                                setTimeout(function () {
                                    submitimg();
                                }, 1000) 
                            })
                        })
                }
            checkgrade();
                // alert(msg);
               // title.innerText = "菜 品 信 息 编 辑";
               // $('#js').html(msg);
                //$.post('../ashx/UserHandler.ashx?type=getUserMenu&UserNumber='+usernumber+'&Size='+size+'&MenuNumber='+menunumber, function (msg) {

               
            
            //JSON.stringify({
            //    "menuname": "menuname",
            //    "kw": kw,
            //    "gy": gy,
            //    "menutype": menutype,
            //    "mainsc": mainsc,
            //    "fl": fl,
            //    "introduce": introduce,
            //    "Tips": Tips
            //})
           
            //$.ajax({
            //    type: "post",
            //    url: "/ashx/UserHandler.ashx?type=UserProduction",
            //    datatype:"json",
            //    data: {
            //            "menuname": "menuname",
            //            "kw": kw,
            //            "gy": gy,
            //            "menutype": menutype,
            //            "mainsc": mainsc,
            //            "fl": fl,
            //            "introduce": introduce,
            //            "Tips": Tips
            //        },
            //    contentType: false,
            //    processData: false,
            //    success: function (data) {

            //    }
            //});
            //setTimeout(function () {
            //    var cptp = document.getElementById("cptp");
            //    cptp.submit();
            //}, 1000)
            //setTimeout(function () {
            //    var hh = document.getElementById("hh"); 
            //    hh.submit();
            //}, 1000)
           
           
            // 创建新文件夹  
          //  fso.CreateFolder ("C:\\Bogus");  
           // alert("Created folder C:\\Bogus" + "\n");  
            // 显示文件夹基础名称，不包含路径名  
          //  alert("Basename = " + fso.GetBaseName("c:\\bogus") + "\n");  
            // 删除创建的文件夹  
          //  fso.DeleteFolder ("C:\\Bogus");  
 
          //  var xhr = new XMLHttpRequest();
          //  xhr.open("POST", "/ashx/Handler2.ashx", true);
            //alert(imgdata.name);
          //  xhr.setRequestHeader("imgfile", imgdata.name);
          //  xhr.send(imgdata);
            //alert("bzjs" + bzall);
            //alert("bztp.length:"+imgdata);
            //$.ajax({
            //    type: "post",
            //    url: "/ashx/Handler2.ashx",
            //    datatype:"json",
            //    data: {"img1":bztpa},
            //    contentType: false,
            //    processData: false,
            //    success: function (data) {

            //    }
            //}); //这两个false的参数一个不能少



            //var foodname = $('#name').val();
            //var foodmaterials = $('#sc').val();
            //var foodtype = $('#type').val();
            //var foodintroduce = $('#introduce').val();
            //var foodpicture = result;
            //if (menunumber != "") {
            //    $.post('../ashx/UserHandler.ashx?type=UserProductionedit&foodname=' + foodname + '&foodmaterials=' + foodmaterials + '&foodtype=' + foodtype + '&foodintroduce=' + foodintroduce + '&foodnumber=' + menunumber + '&usernumber='+usernumber, function () {

            //        alert("菜品修改成功，可以在个人作品查看！");
            //        window.location = "../html/index.html";

            //    });

            //} else {
            //    $.post('../ashx/UserHandler.ashx?type=FoodProduction&foodname=' + foodname + '&foodmaterials=' + foodmaterials + '&foodtype=' + foodtype + '&foodintroduce=' + foodintroduce, function () {

            //        alert("菜品制作成功，可以在个人作品查看！");
            //        window.location = "../html/index.html";

            //    });

            //}
           

        }



        //创建文件夹
        function createFloder(){
            var fso, fldr, s = "";
            fso = new ActiveXObject("Scripting.FileSystemObject");
            if(!fso.FolderExists("")){     //判断文件夹是否存在，不存在就创建
                fso.CreateFolder ("E:\\html");
            }
        }

        //产生随机图片名称
        function createPic(){
            var now=new Date(); 
            var year = now.getFullYear(); //得到年份
            var month = now.getMonth();//得到月份
            var date = now.getDate();//得到日期
            var hour = now.getHours();//得到小时
            var minu = now.getMinutes();//得到分钟
            month = month + 1;
            if (month < 10) month = "0" + month;
            if (date < 10) date = "0" + date;
            var number = now.getSeconds()%43; //这将产生一个基于目前时间的0到42的整数。
            var time = year + month + date+hour+minu;
            return time+"_"+number;
        }
 
        function back() {
            window.location = "../html/HtmlForUser.html";
        }
    </script>

</body>
</html>
